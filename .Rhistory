mrn_split[1]
mrn_split[[1]
result <- dt %>%
group_by(.dots=c("mrn","enc")) %>%
mrn_split[[1]]
View(mrn_split)
group_by(dt, mrn, enc)
gsplit <- group_by(dt, mrn, enc)
View(gsplit)
gsplit <- shift(group_by(dt, mrn, enc)$creatinine, n=-1)
size(gsplit)
shape(gsplit)
length(gsplit)
gsplit[-1]
gsplit[[-1]]
gsplit[[1]]
gsplit[1
]
gsplit[-1]
length(gsplit)
gsplit(length(gsplit)-1)
gsplit[length(gsplit)-1]
gsplit[length(gsplit)]
gb <- group_by(dt, c(mrn, enc))
gb <- group_by(dt, c('mrn', 'enc'))
gb <- group_by(dt, mrn, enc))
gb <- group_by(dt, mrn, enc)
View(gb)
gb <- group_by(dt, mrn)
gb <- group_by(gb, enc, add=True)
gb <- group_by(gb, enc, add=TRUE)
class(gb)
gb
shift(gb$creatinine, n=-1)
group_by(gb)
class(group_by(gb))
gb
class(gb)
class(dt)
View(dt)
dt %>% group_by(mrn)
res <- dt %>% group_by(mrn)
shift(res)
shift(res$creat)
shift(res$creatinine)
res <- dt %>% group_by(enc)
shift(res$creatinine)
shift(group_by(dt$enc))
lg <- function(x)c(NA, x[1:(length(x)-1)])
dt[, creat.shift := lg(creat), by = c('enc')]
dt[, creat.shift := lg(creatinine), by = c('enc')]
dt[, creatshift := lg(creatinine), by = c('enc')]
dt[, creatshift := lg(dt$creatinine), by = c('enc')]
dt[, creatshift := lg(creatinine), by = c('enc')]
dt[, creatshift := lg(creatinine), by = 'enc']
shift(group_by(dt$enc))
shift(group_by(dt, enc))
shift(group_by(dt, enc))
shift(group_by(dt, enc))
res <- shift(group_by(dt, enc))
View(res)
res <- shift(group_by(dt, enc)$creatinine)
res <- shift(group_by(dt, enc)$creatinine)
View(mrn_split)
dt$creat.shift <- res
rm(gsplit)
View(dt)
rm(gb)
rm(list=ls())
library(data.table)
library(stringr)
library(base)
library(stats)
library(dplyr)
library(shiny)
#Read in the data
dt <- fread('/Users/saranmedical-smile/Desktop/patr/StandardizingAKI/inpatient 2014-2018 creatinine.csv')
#Renaming mrn & enc columns
colnames(dt)[colnames(dt) %in% c('pat_mrn_id','pat_enc_csn_id')] = c('mrn', 'enc')
#Removing 'MR' from mrn #'s since numeric indexing is faster
dt$mrn <- substr(dt$mrn, 3, nchar(dt$mrn))
dt <- transform(dt, mrn = as.integer(mrn))
#Convert time to datetime POSIXct
dt <- transform(dt, time = as.POSIXct(time, format='%Y-%m-%dT%H:%M:%S'))
sapply(dt, class) #check to make sure that each column is dtype we want
View(dt)
dt$creat.shift <- shift(group_by(dt, enc)$creatinine)
group_by(dt, enc)$creatinine
group_by(dt, enc)
shift(group_by(dt, enc))
data[, creat.shift:=c(NA, creatinine[-.N]), by=enc]
dt[, creat.shift:=c(NA, creatinine[-.N]), by=enc]
dt[, creat.shift:=c(NA, creatinine[-.N]), by=enc]
dt[, creat.shift: = c(NA, creatinine[-.N]), by=enc]
dt[, creat.shift:= c(NA, creatinine[-.N]), by=enc]
dt = dt[, creat.shift:= c(NA, creatinine[-.N]), by=enc]
dt
dt = dt[, creat.shift:= c(NA, creatinine[.N]), by=enc]
dt = dt[, creat.shift:= c(NA, creatinine[-.N]), by=enc]
dt = dt[, creat.shift:= c(NA, creatinine[-.N]), by=enc]
dt
View(dt)
head(dt)
a <- 1:10
a[-.N]
a[[-.N]]
list(a)
a
a <- list(a)
a
a[-.N]
dt = dt[, creat.shift:= c(NA, creatinine[.N]), by=enc]
dt = dt[, creat.shift:= c(NA, creatinine[-.N]), by=enc]
dt = dt[, creat.shift := c(NA, creatinine[-.N]), by=enc] #Ask Mike... what does -.N do?
head(dt)
dt$creat.delta <- dt$creat.shift - dt$creatinine
dt <- dt[, creat.shift := c(creatinine[-.N], NA), by=enc] #Ask Mike... what does -.N do? and maybe while I'm at it what does := do?
View(dt)
dt <- dt[, creat.shift := c(creatinine[1-.N], NA), by=enc] #Ask Mike... what does -.N do? and maybe while I'm at it what does := do?
dt <- dt[, creat.shift := c(creatinine[1-.N], NA), by=enc] #Ask Mike... what does -.N do? and maybe while I'm at it what does := do?
View(dt)
dt <- dt[, creat.shift := c(creatinine[-.N-1], NA), by=enc] #Ask Mike... what does -.N do? and maybe while I'm at it what does := do?
dt <- dt[, creat.shift := c(creatinine[-.N]-1, NA), by=enc] #Ask Mike... what does -.N do? and maybe while I'm at it what does := do?
View(dt)
dt <- dt[, creat.shift := c(creatinine[-.N], NA), by=enc] #Ask Mike... what does -.N do? and maybe while I'm at it what does := do?
dt <- dt[, creat.shift := c(creatinine[:-.N], NA), by=enc] #Ask Mike... what does -.N do? and maybe while I'm at it what does := do?
typeof(creatinine)
typeof(dt$creatinine)
dt <- dt[, creat.shift := shift(creatinine, -1), by=enc] #Ask Mike... what does -.N do? and maybe while I'm at it what does := do?
View(dt)
dt$creat.delta <- dt$creat.shift - dt$creatinine
View(dt)
dt$creat.delta <- shift(dt$creat.shift - dt$creatinine, n = 1)
#Read in the data
dt <- fread('/Users/saranmedical-smile/Desktop/patr/StandardizingAKI/inpatient 2014-2018 creatinine.csv')
#Renaming mrn & enc columns
colnames(dt)[colnames(dt) %in% c('pat_mrn_id','pat_enc_csn_id')] = c('mrn', 'enc')
#Removing 'MR' from mrn #'s since numeric indexing is faster
dt$mrn <- substr(dt$mrn, 3, nchar(dt$mrn))
dt <- transform(dt, mrn = as.integer(mrn))
#Convert time to datetime POSIXct
dt <- transform(dt, time = as.POSIXct(time, format='%Y-%m-%dT%H:%M:%S'))
sapply(dt, class) #check to make sure that each column is dtype we want
View(dt)
dt <- dt[, creat.shift := shift(creatinine, n = -1), by=enc] #Ask Mike... what does -.N do? and maybe while I'm at it what does := do?
dt$creat.delta <- shift(dt$creat.shift - dt$creatinine, n = 1)
#data[, lag.value:=c(NA, value[-.N]), by=groups] ... ask Mike what the -.N index is & maybe what := is
dt$creat.delta <- shift(dt$creat.shift - dt$creatinine, n = 1)
View(dt)
dt[, creat.delta > 0.3]
#data[, lag.value:=c(NA, value[-.N]), by=groups] ... ask Mike what the -.N index is & maybe what := is
dt$creat.delta <- shift(dt$creat.shift - dt$creatinine, n = 1)
View(dt)
#Create change in time var
dt$time.delta <- difftime(shift(dt$time, n=-1), dt$time, units='hours')
View(dt)
#Create change in time var
dt <- dt[, time.shift := shift(time, n=-1), by = enc]
dt$time.delta <- difftime(shift(dt$time, n=-1), dt$time, units='hours')
View(dt)
dt$time.delta <- difftime(shift(dt$time, n=-1), dt$time, units='hours')
View(dt)
dt$time.delta <- difftime(time.shift, time, units='hours')
#Create change in time var
dt <- dt[, time.shift := shift(time, n = -1), by = enc]
dt$time.delta <- difftime(dt$time.shift, dt$time, units='hours')
View(dt)
library(data.table)
library(stringr)
library(base)
library(stats)
library(dplyr)
library(shiny)
#Read in the data
dt <- fread('/Users/saranmedical-smile/Desktop/patr/StandardizingAKI/inpatient 2014-2018 creatinine.csv')
#Renaming mrn & enc columns
colnames(dt)[colnames(dt) %in% c('pat_mrn_id','pat_enc_csn_id')] = c('mrn', 'enc')
#Removing 'MR' from mrn #'s since numeric indexing is faster
dt$mrn <- substr(dt$mrn, 3, nchar(dt$mrn))
dt <- transform(dt, mrn = as.integer(mrn))
#Convert time to datetime POSIXct
dt <- transform(dt, time = as.POSIXct(time, format='%Y-%m-%dT%H:%M:%S'))
sapply(dt, class) #check to make sure that each column is dtype we want
#Create change in creatinine var
dt <- dt[, creat.shift := shift(creatinine, n = -1), by = enc]
#data[, lag.value:=c(NA, value[-.N]), by=groups] ... ask Mike what the -.N index is & maybe what := is
dt$creat.delta <- shift(dt$creat.shift - dt$creatinine, n = 1)
#Create change in time var
dt <- dt[, time.shift := shift(time, n = -1), by = enc]
dt$time.delta <- difftime(dt$time.shift, dt$time, units='hours')
View(dt)
#data[, lag.value:=c(NA, value[-.N]), by=groups] ... ask Mike what the -.N index is & maybe what := is
dt$delta.creat <- shift(dt$creat.shift - dt$creatinine, n = 1)
dt$delta.time <- difftime(dt$time.shift, dt$time, units='hours')
dt[,creat.delta=NULL]
dt$creat.delta <- NULL
dt$time.delta <- NULL
View(dt)
delta.time
dt$delta.time
'48 hours'
as.POSIXct('48 hours')
as.POSIXct('48', format='%H')
as.POSIXct(48, format='%H')
hours(48)
library(chron)
install.packages(chron)
as.POSIXct(3)
as.POSIXct(3, origin=)
library(chron)
install.packages(data.table)
library(chron)
install.packages("chron")
library(chron)
install.packages("chron")
install.packages('chron')
strptime(6)
strptime(6, format='H')
strptime(6, format='hours')
strptime(6, format='%H')
t1 <- '2000-01-01'
t2 <- '2000-01-01 08:00:00'
difftime(t2, t1)
dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
View(dt)
t2 <- '2000-01-01 11:00:00'
dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
dt[, delta.time < difftime(t2, t1)]
dt$tmp <- dt[, delta.time < difftime(t2, t1)]
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
rw_cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
rm(cond1)
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
t3 <- '2000-01-01'
t4 <- '2000-01-08'
difftime(t4, t3)
cond2 <- dt[, delta.creat > 0.5*shift(creatinine, n=1)]
dt$cond2 <- cond2
dt$cond1 <- cond1
View(dt)
dt[,cond1]
head(dt[,cond1])
head(dt[,cond1==TRUE]
head(dt[,cond1==TRUE])
head(dt[,cond1=TRUE])
head(dt[, cond1 == TRUE])
head(dt[, dt$cond1 == TRUE])
head(dt[dt$cond1 == TRUE])
head(dt[dt$cond1 == TRUE])
dt$cond1
dt$cond1 == TRUE
dt[dt$cond1 == TRUE]
c1 <- dt[dt$cond1 == TRUE]
View(c1)
dt$cond1
sumdt$cond1
sum(dt$cond1)
dt[c('cond1', 'cond2')][is.na(df[c('cond1', cond2)])]
dt[c('cond1', 'cond2')][is.na(df[c('cond1', 'cond2')])] <- FALSE
dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
is.na(dt[c('cond1', 'cond2')])
replace(df, is.na(df), FALSE)
replace(dt, is.na(dt), FALSE)
View(dt)
replace(dt$cond1, is.na(dt$cond1), FALSE)
View(dt)
length(replace(dt$cond1, is.na(dt$cond1), FALSE))
library(data.table)
library(stringr)
library(base)
library(stats)
library(dplyr)
library(shiny)
#Read in the data
dt <- fread('/Users/saranmedical-smile/Desktop/patr/StandardizingAKI/inpatient 2014-2018 creatinine.csv')
#Renaming mrn & enc columns
colnames(dt)[colnames(dt) %in% c('pat_mrn_id','pat_enc_csn_id')] = c('mrn', 'enc')
#Removing 'MR' from mrn #'s since numeric indexing is faster
dt$mrn <- substr(dt$mrn, 3, nchar(dt$mrn))
dt <- transform(dt, mrn = as.integer(mrn))
#Convert time to datetime POSIXct
dt <- transform(dt, time = as.POSIXct(time, format='%Y-%m-%dT%H:%M:%S'))
sapply(dt, class) #check to make sure that each column is dtype we want
#Create change in creatinine var
dt <- dt[, creat.shift := shift(creatinine, n = -1), by = enc]
#data[, lag.value:=c(NA, value[-.N]), by=groups] ... ask Mike what the -.N index is & maybe what := is
dt$delta.creat <- shift(dt$creat.shift - dt$creatinine, n = 1)
#Create change in time var
dt <- dt[, time.shift := shift(time, n = -1), by = enc]
dt$delta.time <- difftime(dt$time.shift, dt$time, units='hours')
#Calculating those who satisfy condition 1 for rolling window AKI
t1 <- '2000-01-01'
t2 <- '2000-01-01 11:00:00'
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
dt$cond1 <- cond1
t3 <- '2000-01-01'
t4 <- '2000-01-08'
difftime(t4, t3)
cond2 <- dt[, delta.creat > 0.5*shift(creatinine, n=1)]
dt$cond2 <- cond2
dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
cond2 <- dt[, delta.creat > 0.5*shift(creatinine, n=1) & delta.time < difftime(t4, t3)]
dt$cond2 <- cond2
View(dt)
rm(c1)
rm(a
)
rm(rw_cond1)
#Calculating those who satisfy condition 1 for rolling window AKI
t1 <- '2000-01-01'
t2 <- '2000-01-01 08:00:00'
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
dt$cond1 <- cond1
t3 <- '2000-01-01'
t4 <- '2000-01-08'
cond2 <- dt[, delta.creat > 0.5*shift(creatinine, n=1) & delta.time < difftime(t4, t3)]
dt$cond2 <- cond2
sum(cond1)
sum(dt$cond1)
table(dt$cond1)
table(dt$cond2)
t2 <- '2000-01-01 48:00:00'
#Calculating those who satisfy condition 1 for rolling window AKI
t1 <- '2000-01-01'
difftime(t2, t1
)
difftime(t2, t1)
#Calculating those who satisfy condition 1 for rolling window AKI
t1 <- '2000-01-01'
t2 <- '2000-01-03'
difftime(t2, t1
)
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
dt$cond1 <- cond1
table(dt$cond1)
dt$cond2 <- cond2
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
dt$cond1 <- cond1
table(dt$cond1)
#Create change in time var
dt <- dt[, time.shift := shift(time, n = -1), by = enc]
dt$delta.time <- difftime(dt$time.shift, dt$time, units='hours')
#Calculating those who satisfy condition 1 for rolling window AKI
t1 <- '2000-01-01'
t2 <- '2000-01-03'
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
dt$cond1 <- cond1
table(dt$cond1)
is.na(dt$cond1)
table(is.na(dt$cond1))
#Calculating those who satisfy condition 1 for rolling window AKI
t1 <- '2000-01-01'
t2 <- '2000-01-03'
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
dt$cond1 <- cond1
cond2 <- dt[, delta.creat > 0.5*shift(creatinine, n=1) & delta.time < difftime(t4, t3)]
dt$cond2 <- cond2
table(dt$cond1)
#dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
c1 <- dt[dt$cond1 == TRUE]
View(dt)
View(c1)
#dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
aki <- dt[dt$cond1 == TRUE | dt$cond2 == TRUE]
View(aki)
View(aki)
#dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
aki <- dt$cond1 == TRUE | dt$cond2 == TRUE
is.na(dt$cond1)
dt['cond1']is.na(dt$cond1)
dt['cond1'][is.na(dt$cond1)]
dt[is.na(dt$cond1)]
dt[is.na(dt$cond1)]$cond1
#dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
dt$aki <- dt$cond1 == TRUE | dt$cond2 == TRUE
dt[is.na(dt$cond1)]$cond1 <- FALSE
dt[is.na(dt$cond2)]$cond2 <- FALSE
#dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
dt$aki <- dt$cond1 == TRUE | dt$cond2 == TRUE
#dt[, creat.delta > 0.3 & ]
#Splitting by MRN (?)
mrn_split <- split(dt, dt$mrn)
View(dt)
dt$delta.creat
table(dt$delta.creat > 0.3)
View(dt)
dt$cond1 == FALSE & dt$cond2 == TRUE
which(dt$cond1 == FALSE & dt$cond2 == TRUE)
which(dt$cond1 == FALSE & dt$cond2 == TRUE)[0]
which(dt$cond1 == FALSE & dt$cond2 == TRUE)[1]
dt[564]
dt[562:566]
dt[560:570]
dt$delta.creat > 0.3
table(dt$delta.creat > 0.3)
rm(list = ls())
library(data.table)
library(stringr)
library(base)
library(stats)
library(dplyr)
library(shiny)
#Read in the data
dt <- fread('/Users/saranmedical-smile/Desktop/patr/StandardizingAKI/inpatient 2014-2018 creatinine.csv')
#Renaming mrn & enc columns
colnames(dt)[colnames(dt) %in% c('pat_mrn_id','pat_enc_csn_id')] = c('mrn', 'enc')
#Removing 'MR' from mrn #'s since numeric indexing is faster
dt$mrn <- substr(dt$mrn, 3, nchar(dt$mrn))
dt <- transform(dt, mrn = as.integer(mrn))
#Convert time to datetime POSIXct
dt <- transform(dt, time = as.POSIXct(time, format='%Y-%m-%dT%H:%M:%S'))
sapply(dt, class) #check to make sure that each column is dtype we want
#Create change in creatinine var
dt <- dt[, creat.shift := shift(creatinine, n = -1), by = enc]
#data[, lag.value:=c(NA, value[-.N]), by=groups] ... ask Mike what the -.N index is & maybe what := is
dt$delta.creat <- shift(dt$creat.shift - dt$creatinine, n = 1)
#Create change in time var
dt <- dt[, time.shift := shift(time, n = -1), by = enc]
dt$delta.time <- difftime(dt$time.shift, dt$time, units='hours')
#Calculating those who satisfy condition 1 for rolling window AKI
t1 <- '2000-01-01'
t2 <- '2000-01-03'
dt$cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
dt$cond1 <- NULL
dt$cond2 <- NULL
View(dt)
head(cond1)
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
head(cond1)
is.na(cond1)
table(is.na(cond1))
table(is.na(dt$delta.time))
dt$creat.shift <- NULL
dt$time.shift <- NULL
table(cond1)
difftime(t2, t1)
table(delta.time < difftime(t2, t1))
table(dt$delta.time < difftime(t2, t1))
dt$delta.time < difftime(t2, t1)
table(dt$delta.time < difftime(t2, t1))
delta.time
dt$delta.time[1]
dt$delta.time[2]
dt$delta.time[3]
#Calculating those who satisfy condition 1 for rolling window AKI
t1 <- '2000-01-01'
t2 <- '2000-01-03'
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
t3 <- '2000-01-01'
t4 <- '2000-01-08'
cond2 <- dt[, delta.creat > 0.5*shift(creatinine, n=1) & delta.time < difftime(t4, t3)]
dt[is.na(dt$cond1)]$cond1 <- FALSE
dt[is.na(dt$cond2)]$cond2 <- FALSE
table(cond1)
?table
table(cond1, useNA = "ifany")
table(cond2, useNA = "ifany")
table(cond1, useNA = 'ifany')
table(cond2, useNA = 'ifany')
#dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
dt$aki <- dt$cond1 == TRUE | dt$cond2 == TRUE
#dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
dt$aki <- cond1 == TRUE | cond2 == TRUE
is.na(cond1)
cond1[is.na(cond1)]
cond1[is.na(cond1)] <- FALSE
cond2[is.na(cond2)] <- FALSE
#dt[c('cond1', 'cond2')][is.na(dt[c('cond1', 'cond2')])] <- FALSE
dt$aki <- cond1 == TRUE | cond2 == TRUE
#dt[, creat.delta > 0.3 & ]
#Splitting by MRN (?)
mrn_split <- split(dt, dt$mrn)
rm(mrn_split)
dt$aki <- cond1 == TRUE | cond2 == TRUE
table(cond1, useNA = 'ifany')
table(cond2, useNA = 'ifany')
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
cond2 <- dt[, delta.creat > 0.5*shift(creatinine, n=1) & delta.time < difftime(t4, t3)]
dt$aki <- cond1 == TRUE | cond2 == TRUE
dt$delta.time <- shift(difftime(dt$time.shift, dt$time, units='hours'), n = 1)
#Read in the data
dt <- fread('/Users/saranmedical-smile/Desktop/patr/StandardizingAKI/inpatient 2014-2018 creatinine.csv')
#Renaming mrn & enc columns
colnames(dt)[colnames(dt) %in% c('pat_mrn_id','pat_enc_csn_id')] = c('mrn', 'enc')
#Removing 'MR' from mrn #'s since numeric indexing is faster
dt$mrn <- substr(dt$mrn, 3, nchar(dt$mrn))
dt <- transform(dt, mrn = as.integer(mrn))
#Convert time to datetime POSIXct
dt <- transform(dt, time = as.POSIXct(time, format='%Y-%m-%dT%H:%M:%S'))
sapply(dt, class) #check to make sure that each column is dtype we want
#Create change in creatinine var
dt <- dt[, creat.shift := shift(creatinine, n = -1), by = enc]
#data[, lag.value:=c(NA, value[-.N]), by=groups] ... ask Mike what the -.N index is & maybe what := is
dt$delta.creat <- shift(dt$creat.shift - dt$creatinine, n = 1)
#Create change in time var
dt <- dt[, time.shift := shift(time, n = -1), by = enc]
dt$delta.time <- shift(difftime(dt$time.shift, dt$time, units='hours'), n = 1)
#Removing the creat shifted & time shifted columns
dt$creat.shift <- NULL
dt$time.shift <- NULL
View(dt)
#Calculating those who satisfy condition 1 for rolling window AKI
t1 <- '2000-01-01'
t2 <- '2000-01-03' #Probably a slow and stupid way to see 8 hours but I'll ask Mike if there's a smarter way...
cond1 <- dt[, delta.creat > 0.3 & delta.time < difftime(t2, t1)]
t3 <- '2000-01-01'
t4 <- '2000-01-08'
cond2 <- dt[, delta.creat > 0.5*shift(creatinine, n=1) & delta.time < difftime(t4, t3)]
table(cond1, useNA = 'ifany')
table(cond2, useNA = 'ifany')
dt$aki <- cond1 == TRUE | cond2 == TRUE
table(dt$aki)
